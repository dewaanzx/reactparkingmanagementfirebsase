{"ast":null,"code":"var _jsxFileName = \"D:\\\\frontendtest_pelindo\\\\react-parking-management-firebase\\\\src\\\\AppContext.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { useState, useContext, useEffect, useCallback } from 'react';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AppContext = /*#__PURE__*/React.createContext();\nlet logoutTimer;\nconst calculateRemainingTime = expirationTime => {\n  const currentTime = new Date().getTime();\n  const adjExpirationTime = new Date(expirationTime).getTime();\n  const remainingTime = adjExpirationTime - currentTime;\n  return remainingTime;\n};\nconst retrieveStoredToken = () => {\n  const storedToken = localStorage.getItem('token');\n  const storedExpirationDate = localStorage.getItem('expirationTime');\n  const remainingTime = calculateRemainingTime(storedExpirationDate);\n  if (remainingTime <= 60000) {\n    localStorage.removeItem('token');\n    localStorage.removeItem('email');\n    localStorage.removeItem('expirationTime');\n    return null;\n  }\n  return {\n    token: storedToken,\n    duration: remainingTime\n  };\n};\nexport const ContextProvider = props => {\n  _s();\n  // Authentication\n  const tokenData = retrieveStoredToken();\n  let initialToken;\n  if (tokenData) {\n    initialToken = tokenData.token;\n  }\n  const currentEmail = localStorage.getItem('email');\n  const [isLogin, setIsLogin] = useState(null);\n  const [email, setEmail] = useState(currentEmail);\n  const [token, setToken] = useState(initialToken);\n  const userIsLoggedIn = !!token;\n  const emailHandler = email => {\n    setEmail(email);\n    localStorage.setItem('email', email);\n  };\n  const logoutHandler = useCallback(() => {\n    setToken(null);\n    setEmail(null);\n    localStorage.removeItem('token');\n    localStorage.removeItem('email');\n    localStorage.removeItem('expirationTime');\n    if (logoutTimer) {\n      clearTimeout(logoutTimer);\n    }\n  }, []);\n  const loginHandler = (token, expirationTime) => {\n    setToken(token);\n    localStorage.setItem('token', token);\n    localStorage.setItem('expirationTime', expirationTime);\n    const remainingTime = calculateRemainingTime(expirationTime);\n    logoutTimer = setTimeout(logoutHandler, remainingTime);\n  };\n  useEffect(() => {\n    if (tokenData) {\n      logoutTimer = setTimeout(logoutHandler, tokenData.duration);\n    }\n  }, [tokenData, logoutHandler]);\n  const switchAuthModeHandler = text => {\n    if (text === 'Log in') {\n      setIsLogin(true);\n    } else {\n      setIsLogin(false);\n    }\n  };\n\n  // Displaying places\n  const [loading, setLoading] = useState(true);\n  const [places, setPlaces] = useState([]);\n  const [searchTerm, setSearchTerm] = useState('');\n  useEffect(() => {\n    const fetchPlaces = async () => {\n      setLoading(true);\n      const response = await fetch(`https://parklane-24dk-default-rtdb.firebaseio.com/places.json?auth=${token}`);\n      if (!response.ok) {\n        throw new Error('Something went wrong!');\n      }\n      const data = await response.json();\n      const loadedPlaces = [];\n      for (const key in data) {\n        loadedPlaces.push({\n          id: key,\n          name: data[key].name,\n          info: data[key].info,\n          price: data[key].price,\n          image: data[key].image\n        });\n      }\n      setPlaces(loadedPlaces);\n      setLoading(false);\n    };\n    fetchPlaces().catch(error => {\n      console.log(error);\n      setLoading(false);\n    });\n  }, [token]);\n  return /*#__PURE__*/_jsxDEV(AppContext.Provider, {\n    value: {\n      isLogin,\n      token,\n      email,\n      loading,\n      places,\n      searchTerm,\n      setSearchTerm,\n      isLoggedIn: userIsLoggedIn,\n      switchAuthModeHandler,\n      loginHandler,\n      logoutHandler,\n      emailHandler\n    },\n    children: props.children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 133,\n    columnNumber: 3\n  }, this);\n};\n_s(ContextProvider, \"nOIssMhgiuua0unro/8FwVWHrs8=\");\n_c = ContextProvider;\nexport const useAppContext = () => {\n  _s2();\n  return useContext(AppContext);\n};\n_s2(useAppContext, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\nvar _c;\n$RefreshReg$(_c, \"ContextProvider\");","map":{"version":3,"names":["React","useState","useContext","useEffect","useCallback","jsxDEV","_jsxDEV","AppContext","createContext","logoutTimer","calculateRemainingTime","expirationTime","currentTime","Date","getTime","adjExpirationTime","remainingTime","retrieveStoredToken","storedToken","localStorage","getItem","storedExpirationDate","removeItem","token","duration","ContextProvider","props","_s","tokenData","initialToken","currentEmail","isLogin","setIsLogin","email","setEmail","setToken","userIsLoggedIn","emailHandler","setItem","logoutHandler","clearTimeout","loginHandler","setTimeout","switchAuthModeHandler","text","loading","setLoading","places","setPlaces","searchTerm","setSearchTerm","fetchPlaces","response","fetch","ok","Error","data","json","loadedPlaces","key","push","id","name","info","price","image","catch","error","console","log","Provider","value","isLoggedIn","children","fileName","_jsxFileName","lineNumber","columnNumber","_c","useAppContext","_s2","$RefreshReg$"],"sources":["D:/frontendtest_pelindo/react-parking-management-firebase/src/AppContext.js"],"sourcesContent":["import React, { useState, useContext, useEffect, useCallback } from 'react';\r\n\r\nconst AppContext = React.createContext();\r\n\r\nlet logoutTimer;\r\n\r\nconst calculateRemainingTime = (expirationTime) => {\r\n\tconst currentTime = new Date().getTime();\r\n\tconst adjExpirationTime = new Date(expirationTime).getTime();\r\n\r\n\tconst remainingTime = adjExpirationTime - currentTime;\r\n\treturn remainingTime;\r\n};\r\n\r\nconst retrieveStoredToken = () => {\r\n\tconst storedToken = localStorage.getItem('token');\r\n\tconst storedExpirationDate = localStorage.getItem('expirationTime');\r\n\r\n\tconst remainingTime = calculateRemainingTime(storedExpirationDate);\r\n\r\n\tif (remainingTime <= 60000) {\r\n\t\tlocalStorage.removeItem('token');\r\n\t\tlocalStorage.removeItem('email');\r\n\t\tlocalStorage.removeItem('expirationTime');\r\n\t\treturn null;\r\n\t}\r\n\r\n\treturn {\r\n\t\ttoken: storedToken,\r\n\t\tduration: remainingTime\r\n\t};\r\n};\r\n\r\nexport const ContextProvider = (props) => {\r\n\t// Authentication\r\n\tconst tokenData = retrieveStoredToken();\r\n\tlet initialToken;\r\n\tif (tokenData) {\r\n\t\tinitialToken = tokenData.token;\r\n\t}\r\n\t\r\n\tconst currentEmail = localStorage.getItem('email');\r\n\r\n\tconst [isLogin, setIsLogin] = useState(null);\r\n\tconst [email, setEmail] = useState(currentEmail);\r\n\tconst [token, setToken] = useState(initialToken);\r\n\tconst userIsLoggedIn = !!token;\r\n\r\n\r\n\tconst emailHandler = (email) => {\r\n\t\tsetEmail(email);\r\n\t\tlocalStorage.setItem('email', email);\r\n\t};\r\n\r\n\tconst logoutHandler = useCallback(() => {\r\n\t\tsetToken(null);\r\n\t\tsetEmail(null);\r\n\r\n\t\tlocalStorage.removeItem('token');\r\n\t\tlocalStorage.removeItem('email');\r\n\t\tlocalStorage.removeItem('expirationTime');\r\n\r\n\t\tif (logoutTimer) {\r\n\t\t\tclearTimeout(logoutTimer);\r\n\t\t}\r\n\t}, []);\r\n\r\n\tconst loginHandler = (token, expirationTime) => {\r\n\t\tsetToken(token);\r\n\r\n\t\tlocalStorage.setItem('token', token);\r\n\t\tlocalStorage.setItem('expirationTime', expirationTime);\r\n\r\n\t\tconst remainingTime = calculateRemainingTime(expirationTime);\r\n\r\n\t\tlogoutTimer = setTimeout(logoutHandler, remainingTime);\r\n\t};\r\n\r\n\r\n\tuseEffect(() => {\r\n\t\tif (tokenData) {\r\n\t\t\tlogoutTimer = setTimeout(logoutHandler, tokenData.duration);\r\n\t\t}\r\n\t}, [tokenData, logoutHandler]);\r\n\r\n\r\n\tconst switchAuthModeHandler = (text) => {\r\n\t\tif (text === 'Log in') {\r\n\t\t\tsetIsLogin(true);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tsetIsLogin(false);\r\n\t\t}\r\n\t};\r\n\r\n\t// Displaying places\r\n\tconst [loading, setLoading] = useState(true);\r\n\tconst [places, setPlaces] = useState([]);\r\n\tconst [searchTerm, setSearchTerm] = useState('');\r\n\r\n\tuseEffect(() => {\r\n\t\tconst fetchPlaces = async () => {\r\n\t\t\tsetLoading(true);\r\n\t\t\tconst response = await fetch(`https://parklane-24dk-default-rtdb.firebaseio.com/places.json?auth=${token}`);\r\n\t\t\tif (!response.ok) {\r\n\t\t\t\tthrow new Error('Something went wrong!');\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tconst data = await response.json();\r\n\t\t\tconst loadedPlaces = [];\r\n\r\n\t\t\tfor (const key in data) {\r\n\t\t\t\tloadedPlaces.push({\r\n\t\t\t\t\tid: key,\r\n\t\t\t\t\tname: data[key].name,\r\n\t\t\t\t\tinfo: data[key].info,\r\n\t\t\t\t\tprice: data[key].price,\r\n\t\t\t\t\timage: data[key].image\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tsetPlaces(loadedPlaces);\r\n\t\t\tsetLoading(false);\r\n\t\t};\r\n\r\n\t\tfetchPlaces().catch(error => {\r\n\t\t\tconsole.log(error);\r\n\t\t\tsetLoading(false);\r\n\t\t});\r\n\t}, [token]);\r\n\r\n\treturn (\r\n\t\t<AppContext.Provider value = {{\r\n\t\t\tisLogin,\r\n\t\t\ttoken,\r\n\t\t\temail, \r\n\t\t\tloading, \r\n\t\t\tplaces,\r\n\t\t\tsearchTerm,\r\n\t\t\tsetSearchTerm,\r\n\t\t\tisLoggedIn: userIsLoggedIn,\r\n\t\t\tswitchAuthModeHandler,\r\n\t\t\tloginHandler,\r\n\t\t\tlogoutHandler,\r\n\t\t\temailHandler\r\n\t\t}}>\r\n\t\t\t{props.children}\r\n\t\t</AppContext.Provider>\r\n\t);\r\n};\r\n\r\nexport const useAppContext = () => {\r\n\treturn useContext(AppContext);\r\n};\r\n\r\n"],"mappings":";;;AAAA,OAAOA,KAAK,IAAIC,QAAQ,EAAEC,UAAU,EAAEC,SAAS,EAAEC,WAAW,QAAQ,OAAO;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAE5E,MAAMC,UAAU,gBAAGP,KAAK,CAACQ,aAAa,CAAC,CAAC;AAExC,IAAIC,WAAW;AAEf,MAAMC,sBAAsB,GAAIC,cAAc,IAAK;EAClD,MAAMC,WAAW,GAAG,IAAIC,IAAI,CAAC,CAAC,CAACC,OAAO,CAAC,CAAC;EACxC,MAAMC,iBAAiB,GAAG,IAAIF,IAAI,CAACF,cAAc,CAAC,CAACG,OAAO,CAAC,CAAC;EAE5D,MAAME,aAAa,GAAGD,iBAAiB,GAAGH,WAAW;EACrD,OAAOI,aAAa;AACrB,CAAC;AAED,MAAMC,mBAAmB,GAAGA,CAAA,KAAM;EACjC,MAAMC,WAAW,GAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC;EACjD,MAAMC,oBAAoB,GAAGF,YAAY,CAACC,OAAO,CAAC,gBAAgB,CAAC;EAEnE,MAAMJ,aAAa,GAAGN,sBAAsB,CAACW,oBAAoB,CAAC;EAElE,IAAIL,aAAa,IAAI,KAAK,EAAE;IAC3BG,YAAY,CAACG,UAAU,CAAC,OAAO,CAAC;IAChCH,YAAY,CAACG,UAAU,CAAC,OAAO,CAAC;IAChCH,YAAY,CAACG,UAAU,CAAC,gBAAgB,CAAC;IACzC,OAAO,IAAI;EACZ;EAEA,OAAO;IACNC,KAAK,EAAEL,WAAW;IAClBM,QAAQ,EAAER;EACX,CAAC;AACF,CAAC;AAED,OAAO,MAAMS,eAAe,GAAIC,KAAK,IAAK;EAAAC,EAAA;EACzC;EACA,MAAMC,SAAS,GAAGX,mBAAmB,CAAC,CAAC;EACvC,IAAIY,YAAY;EAChB,IAAID,SAAS,EAAE;IACdC,YAAY,GAAGD,SAAS,CAACL,KAAK;EAC/B;EAEA,MAAMO,YAAY,GAAGX,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC;EAElD,MAAM,CAACW,OAAO,EAAEC,UAAU,CAAC,GAAG/B,QAAQ,CAAC,IAAI,CAAC;EAC5C,MAAM,CAACgC,KAAK,EAAEC,QAAQ,CAAC,GAAGjC,QAAQ,CAAC6B,YAAY,CAAC;EAChD,MAAM,CAACP,KAAK,EAAEY,QAAQ,CAAC,GAAGlC,QAAQ,CAAC4B,YAAY,CAAC;EAChD,MAAMO,cAAc,GAAG,CAAC,CAACb,KAAK;EAG9B,MAAMc,YAAY,GAAIJ,KAAK,IAAK;IAC/BC,QAAQ,CAACD,KAAK,CAAC;IACfd,YAAY,CAACmB,OAAO,CAAC,OAAO,EAAEL,KAAK,CAAC;EACrC,CAAC;EAED,MAAMM,aAAa,GAAGnC,WAAW,CAAC,MAAM;IACvC+B,QAAQ,CAAC,IAAI,CAAC;IACdD,QAAQ,CAAC,IAAI,CAAC;IAEdf,YAAY,CAACG,UAAU,CAAC,OAAO,CAAC;IAChCH,YAAY,CAACG,UAAU,CAAC,OAAO,CAAC;IAChCH,YAAY,CAACG,UAAU,CAAC,gBAAgB,CAAC;IAEzC,IAAIb,WAAW,EAAE;MAChB+B,YAAY,CAAC/B,WAAW,CAAC;IAC1B;EACD,CAAC,EAAE,EAAE,CAAC;EAEN,MAAMgC,YAAY,GAAGA,CAAClB,KAAK,EAAEZ,cAAc,KAAK;IAC/CwB,QAAQ,CAACZ,KAAK,CAAC;IAEfJ,YAAY,CAACmB,OAAO,CAAC,OAAO,EAAEf,KAAK,CAAC;IACpCJ,YAAY,CAACmB,OAAO,CAAC,gBAAgB,EAAE3B,cAAc,CAAC;IAEtD,MAAMK,aAAa,GAAGN,sBAAsB,CAACC,cAAc,CAAC;IAE5DF,WAAW,GAAGiC,UAAU,CAACH,aAAa,EAAEvB,aAAa,CAAC;EACvD,CAAC;EAGDb,SAAS,CAAC,MAAM;IACf,IAAIyB,SAAS,EAAE;MACdnB,WAAW,GAAGiC,UAAU,CAACH,aAAa,EAAEX,SAAS,CAACJ,QAAQ,CAAC;IAC5D;EACD,CAAC,EAAE,CAACI,SAAS,EAAEW,aAAa,CAAC,CAAC;EAG9B,MAAMI,qBAAqB,GAAIC,IAAI,IAAK;IACvC,IAAIA,IAAI,KAAK,QAAQ,EAAE;MACtBZ,UAAU,CAAC,IAAI,CAAC;IACjB,CAAC,MACI;MACJA,UAAU,CAAC,KAAK,CAAC;IAClB;EACD,CAAC;;EAED;EACA,MAAM,CAACa,OAAO,EAAEC,UAAU,CAAC,GAAG7C,QAAQ,CAAC,IAAI,CAAC;EAC5C,MAAM,CAAC8C,MAAM,EAAEC,SAAS,CAAC,GAAG/C,QAAQ,CAAC,EAAE,CAAC;EACxC,MAAM,CAACgD,UAAU,EAAEC,aAAa,CAAC,GAAGjD,QAAQ,CAAC,EAAE,CAAC;EAEhDE,SAAS,CAAC,MAAM;IACf,MAAMgD,WAAW,GAAG,MAAAA,CAAA,KAAY;MAC/BL,UAAU,CAAC,IAAI,CAAC;MAChB,MAAMM,QAAQ,GAAG,MAAMC,KAAK,CAAC,sEAAsE9B,KAAK,EAAE,CAAC;MAC3G,IAAI,CAAC6B,QAAQ,CAACE,EAAE,EAAE;QACjB,MAAM,IAAIC,KAAK,CAAC,uBAAuB,CAAC;MACzC;MAEA,MAAMC,IAAI,GAAG,MAAMJ,QAAQ,CAACK,IAAI,CAAC,CAAC;MAClC,MAAMC,YAAY,GAAG,EAAE;MAEvB,KAAK,MAAMC,GAAG,IAAIH,IAAI,EAAE;QACvBE,YAAY,CAACE,IAAI,CAAC;UACjBC,EAAE,EAAEF,GAAG;UACPG,IAAI,EAAEN,IAAI,CAACG,GAAG,CAAC,CAACG,IAAI;UACpBC,IAAI,EAAEP,IAAI,CAACG,GAAG,CAAC,CAACI,IAAI;UACpBC,KAAK,EAAER,IAAI,CAACG,GAAG,CAAC,CAACK,KAAK;UACtBC,KAAK,EAAET,IAAI,CAACG,GAAG,CAAC,CAACM;QAClB,CAAC,CAAC;MACH;MAEAjB,SAAS,CAACU,YAAY,CAAC;MACvBZ,UAAU,CAAC,KAAK,CAAC;IAClB,CAAC;IAEDK,WAAW,CAAC,CAAC,CAACe,KAAK,CAACC,KAAK,IAAI;MAC5BC,OAAO,CAACC,GAAG,CAACF,KAAK,CAAC;MAClBrB,UAAU,CAAC,KAAK,CAAC;IAClB,CAAC,CAAC;EACH,CAAC,EAAE,CAACvB,KAAK,CAAC,CAAC;EAEX,oBACCjB,OAAA,CAACC,UAAU,CAAC+D,QAAQ;IAACC,KAAK,EAAI;MAC7BxC,OAAO;MACPR,KAAK;MACLU,KAAK;MACLY,OAAO;MACPE,MAAM;MACNE,UAAU;MACVC,aAAa;MACbsB,UAAU,EAAEpC,cAAc;MAC1BO,qBAAqB;MACrBF,YAAY;MACZF,aAAa;MACbF;IACD,CAAE;IAAAoC,QAAA,EACA/C,KAAK,CAAC+C;EAAQ;IAAAC,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACK,CAAC;AAExB,CAAC;AAAClD,EAAA,CApHWF,eAAe;AAAAqD,EAAA,GAAfrD,eAAe;AAsH5B,OAAO,MAAMsD,aAAa,GAAGA,CAAA,KAAM;EAAAC,GAAA;EAClC,OAAO9E,UAAU,CAACK,UAAU,CAAC;AAC9B,CAAC;AAACyE,GAAA,CAFWD,aAAa;AAAA,IAAAD,EAAA;AAAAG,YAAA,CAAAH,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}